## rust è°ƒç”¨Cè¯­è¨€æ–¹æ¡ˆ1

ä½¿ç”¨å®˜æ–¹æä¾›çš„cc-rsåº“
Cargo.tomlä¸­æ·»åŠ 
```toml
[build-dependencies]                                                                                                                                                               cc = "1.0.79"
```
Cè¯­è¨€codeï¼š `bar.c`
```c
#include <stdio.h>

int p_hello(void)
{
        printf("hello, Rust!!!\n");
        return 0;
}
```
`build.rs`
```rust
fn main() {
    cc::Build::new()
        .file("bar.c")
        .compile("bar");
    println!("cargo:rustc-link-lib={}", "bar");
}
```

rustè°ƒç”¨ `src/main.rs`
```rust
extern {
    fn p_hello()-> i32;
}

fn main() {
    unsafe {
        p_hello();
    }
}
```

output
```
hello, Rust!!!
```

# å®
ä¸­è‹±æ–‡è¯¦ç»†æ–‡æ¡£ [ä¸­æ–‡](https://zjp-cn.github.io/tlborm/introduction.html) [English](https://veykril.github.io/tlborm/)
## å®çš„å±•å¼€æ“ä½œ
```bash
rustc +nightly -Zunpretty=expanded code.rs
```

```rust
// Shorthand for initializing a `String`.
macro_rules! S {
    ($e:expr) => {String::from($e)};
}

fn main() {
    let world = S!("World");
    println!("Hello, {}!", world);
}
```

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ï¼š

```shell
rustc +nightly -Zunpretty=expanded hello.rs
```

ç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼ˆé’ˆå¯¹æ ¼å¼è¿›è¡Œäº†ä¿®æ”¹ï¼‰ï¼š
```rust
#![feature(prelude_import)]
#[prelude_import]
use std::prelude::rust_2018::*;
#[macro_use]
extern crate std;
// Shorthand for initializing a `String`.
macro_rules! S { ($e : expr) => { String :: from($e) } ; }

fn main() {
    let world = String::from("World");
    {
        ::std::io::_print(
            ::core::fmt::Arguments::new_v1(
                &["Hello, ", "!\n"],
                &match (&world,) {
                    (arg0,) => [
                        ::core::fmt::ArgumentV1::new(arg0, ::core::fmt::Display::fmt)
                    ],
                }
            )
        );
    };
}
```

## [å…ƒå˜é‡](https://zjp-cn.github.io/tlborm/decl-macros/macros-methodical.html#%E5%85%83%E5%8F%98%E9%87%8F)

matcher è¿˜å¯ä»¥åŒ…å«æ•è· (captures)ã€‚å³åŸºäºæŸç§é€šç”¨è¯­æ³•ç±»åˆ«æ¥åŒ¹é…è¾“å…¥ï¼Œå¹¶å°†ç»“æœæ•è·åˆ°å…ƒå˜é‡ (metavariable) ä¸­ï¼Œç„¶åå°†æ›¿æ¢å…ƒå˜é‡åˆ°è¾“å‡ºã€‚

æ•è·çš„ä¹¦å†™æ–¹å¼æ˜¯ï¼šå…ˆå†™ç¾å…ƒç¬¦å·Â `$`ï¼Œç„¶åè·Ÿä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œç„¶åæ˜¯å†’å·Â `:`ï¼Œæœ€åæ˜¯æ•è·æ–¹å¼ï¼Œæ¯”å¦‚Â `$e:expr`ã€‚

æ•è·æ–¹å¼åˆè¢«ç§°ä½œâ€œç‰‡æ®µåˆ†ç±»ç¬¦â€ ([fragment-specifier](https://doc.rust-lang.org/nightly/reference/macros-by-example.html#metavariables))ï¼Œå¿…é¡»æ˜¯ä»¥ä¸‹ä¸€ç§ï¼š

-   [`block`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#block)ï¼šä¸€ä¸ªå—ï¼ˆæ¯”å¦‚ä¸€å—è¯­å¥æˆ–è€…ç”±å¤§æ‹¬å·åŒ…å›´çš„ä¸€ä¸ªè¡¨è¾¾å¼ï¼‰
-   [`expr`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#expr)ï¼šä¸€ä¸ªè¡¨è¾¾å¼ (expression)
-   [`ident`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#ident)ï¼šä¸€ä¸ªæ ‡è¯†ç¬¦ (identifier)ï¼ŒåŒ…æ‹¬å…³é”®å­— (keywords)
-   [`item`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#item)ï¼šä¸€ä¸ªæ¡ç›®ï¼ˆæ¯”å¦‚å‡½æ•°ã€ç»“æ„ä½“ã€æ¨¡å—ã€`impl`Â å—ï¼‰
-   [`lifetime`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#lifetime)ï¼šä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼ˆæ¯”å¦‚Â `'foo`ã€`'static`ï¼‰
-   [`literal`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#literal)ï¼šä¸€ä¸ªå­—é¢å€¼ï¼ˆæ¯”å¦‚Â `"Hello World!"`ã€`3.14`ã€`'ğŸ¦€'`ï¼‰
-   [`meta`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#meta)ï¼šä¸€ä¸ªå…ƒä¿¡æ¯ï¼ˆæ¯”å¦‚Â `#[...]`Â å’ŒÂ `#![...]`Â å±æ€§å†…éƒ¨çš„ä¸œè¥¿ï¼‰
-   [`pat`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#pat)ï¼šä¸€ä¸ªæ¨¡å¼ (pattern)
-   [`path`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#path)ï¼šä¸€æ¡è·¯å¾„ï¼ˆæ¯”å¦‚Â `foo`ã€`::std::mem::replace`ã€`transmute::<_, int>`ï¼‰
-   [`stmt`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#stmt)ï¼šä¸€æ¡è¯­å¥ (statement)
-   [`tt`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#tt)ï¼šå•æ£µæ ‡è®°æ ‘
-   [`ty`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#ty)ï¼šä¸€ä¸ªç±»å‹
-   [`vis`](https://zjp-cn.github.io/tlborm/decl-macros/minutiae/fragment-specifiers.html#vis)ï¼šä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„å¯è§†æ ‡è¯†ç¬¦ï¼ˆæ¯”å¦‚Â `pub`ã€`pub(in crate)`ï¼‰